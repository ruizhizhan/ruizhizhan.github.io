<h1>DEBUG_TEST_IS_HERE</h1>
{{/* Hugo Blox: Resume Biography 3 Block */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $text := $block.content.text | emojify | markdownify | safeHTML }}

{{ $person_page_path := $block.content.username }}
{{ $person_page := site.GetPage (printf "/authors/%s" $person_page_path) }}
{{ if not $person_page }}
  {{ errorf "The `username` '%s' defined in the 'resume-biography-3' block content does not exist in 'content/authors/'." $person_page_path }}
{{ end }}
{{ $person := $person_page.Params }}
{{ $avatar := ($person_page.Resources.ByType "image").GetMatch "*avatar*" }}
{{ $avatar_shape := $block.design.avatar.shape | default "circle" }}

<div class="resume-biography-3 px-6 py-12 lg:py-20 mx-auto max-w-7xl flex flex-col md:flex-row items-center justify-center gap-12">
  
  {{/* Avatar Column */}}
  <div class="flex-none w-48 h-48 md:w-64 md:h-64 relative">
    {{ if $avatar }}
      {{ $avatar_image := $avatar.Fill "500x500 Center webp" }}
      <img src="{{ $avatar_image.RelPermalink }}" alt="{{ $person.name.display }}" 
           class="w-full h-full object-cover {{ if eq $avatar_shape "circle" }}rounded-full{{ else if eq $avatar_shape "rounded" }}rounded-xl{{ end }} shadow-lg ring-4 ring-white dark:ring-gray-800"
           width="{{ $avatar_image.Width }}" height="{{ $avatar_image.Height }}" loading="eager">
      {{/* Status Icon */}}
      {{ if $person.status.icon }}
        <span class="absolute bottom-2 right-2 bg-white dark:bg-gray-800 rounded-full p-2 text-2xl shadow-md border border-gray-100 dark:border-gray-700" aria-label="Status">
          {{ $person.status.icon | emojify }}
        </span>
      {{ end }}
    {{ end }}
  </div>

  {{/* Text Column */}}
  <div class="flex-1 text-center md:text-left">
    <h1 class="text-4xl font-bold tracking-tight text-gray-900 dark:text-white sm:text-5xl mb-2">
      {{ $person.name.display }}
    </h1>
    
    <p class="text-xl text-gray-500 dark:text-gray-400 mb-6">
      {{ $person.role }}
      {{ if $person.organizations }}
        <span class="mx-2">·</span>
        {{ range $index, $org := $person.organizations }}
          <a href="{{ $org.url }}" target="_blank" rel="noopener" class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors">{{ $org.name }}</a>
          {{ if lt (add $index 1) (len $person.organizations) }}, {{ end }}
        {{ end }}
      {{ end }}
    </p>

    {{/* Bio - 核心修改位置 */}}
    {{/* 原版是 safeHTML，这里改成了 markdownify 以支持链接 */}}
    <div class="prose prose-slate prose-lg dark:prose-invert mx-auto md:mx-0 mb-8 text-gray-600 dark:text-gray-300">
      {{ $person.bio | markdownify | emojify }}
    </div>

    {{/* Social Links */}}
    <div class="flex flex-wrap gap-4 justify-center md:justify-start mb-8">
      {{ range $person.links }}
        {{ $pack := or .icon_pack "fas" }}
        {{ $pack_prefix := $pack }}
        {{ if in (slice "fab" "fas" "far" "fal") $pack }}
          {{ $pack_prefix = "fa" }}
        {{ end }}
        <a href="{{ .url }}" target="_blank" rel="noopener" 
           class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 hover:bg-primary-100 dark:hover:bg-primary-900 hover:text-primary-700 dark:hover:text-primary-300 transition-all text-sm font-medium">
          <i class="{{ $pack }} {{ $pack_prefix }}-{{ .icon }}"></i>
          {{ .label | default .icon }}
        </a>
      {{ end }}
    </div>

    {{/* Download Button from block content */}}
    {{ if $block.content.button.text }}
      <div class="flex justify-center md:justify-start">
        <a href="{{ $block.content.button.url }}" 
           class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
          {{ $block.content.button.text }}
        </a>
      </div>
    {{ end }}

  </div>
</div>
